!function(t){var e=function(e){var s=".modules-dropzone",i=t(e),r=i.data("api"),o=t(s,e);i.hasClass("modules-readonly")||o._sortable({connectWith:s,update:function(e,s){var i=t(this),o=i.data("count");"visible"==t(this).data("entries")&&o<=i.children().length&&(id=s.item.data("uid"),to=s.item.index()+1,t.post(r,{action:"sort",id:id,to:to},function(){app.content.reload()}))},start:function(e,s){t(this)._sortable("refreshPositions")},receive:function(e,s){"invisible"==t(this).data("entries")&&t.post(r,{action:"hide",id:s.item.data("uid")},function(){app.content.reload()})}}).disableSelection()};t.widget("ui._sortable",t.ui.sortable,{_mouseStart:function(e,s,i){var r,o,n=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(e),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},t.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this._createPlaceholder(),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(e),this.originalPageX=e.pageX,this.originalPageY=e.pageY,n.cursorAt&&this._adjustOffsetFromHelper(n.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),n.containment&&this._setContainment(),n.cursor&&"auto"!==n.cursor&&(o=this.document.find("body"),this.storedCursor=o.css("cursor"),o.css("cursor",n.cursor),this.storedStylesheet=t("<style>*{ cursor: "+n.cursor+" !important; }</style>").appendTo(o)),n.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",n.opacity)),n.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",n.zIndex)),this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",e,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!i)for(r=this.containers.length-1;r>=0;r--)this.containers[r]._trigger("activate",e,this._uiHash(this));return t.ui.ddmanager&&(t.ui.ddmanager.current=this),t.ui.ddmanager&&!n.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(e),!0}}),t.fn.modules=function(){return this.each(function(){if(t(this).data("modules"))return t(this);var s=new e(this);return t(this).data("modules",s),t(this)})}}(jQuery);